<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dictionary - AfroLingua</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/AI/styles/dictionary.css">
</head>
<body>
    <div class="container">
        <h1>Dictionary</h1>
        <div id="languageDisplay">Loading language...</div>
        <input type="text" id="searchBox" placeholder="Enter a word to search">
        <button id="searchButton">Search</button>
        <div id="resultBox">
            <ol id="resultList">
                <li>Definition will appear here</li>
            </ol>
            <div class="loader" id="loader"></div>
        </div>
    </div>

    <script>
        const searchBox = document.getElementById('searchBox');
        const searchButton = document.getElementById('searchButton');
        const resultBox = document.getElementById('resultBox');
        const resultList = document.getElementById('resultList');
        const languageDisplay = document.getElementById('languageDisplay');
        const loader = document.getElementById('loader');

        // Get language from URL params or default to Yoruba
        async function loadLanguage() {
            const urlParams = new URLSearchParams(window.location.search);
            const language = urlParams.get('language') || 'yoruba';
            languageDisplay.textContent = `${language.charAt(0).toUpperCase() + language.slice(1)} Dictionary`;
        }

        // Search function using server endpoint
        async function lookupWord() {
            const word = searchBox.value.trim();
            const urlParams = new URLSearchParams(window.location.search);
            const language = urlParams.get('language') || 'yoruba';

            if (!word) {
                resultList.innerHTML = '<li>Please enter a word to search</li>';
                return;
            }

            loader.style.display = 'block'; // Show black circular progress indicator
            resultList.innerHTML = ''; // Clear previous content

            try {
                const response = await fetch('http://localhost:5000/dictionary', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ language, word })
                });
                const result = await response.json();
                if (result.success) {
                    // Split the data into lines and create list items
                    const lines = result.data.split('\n');
                    resultList.innerHTML = lines.map(line => `<li>${line}</li>`).join('');
                } else {
                    resultList.innerHTML = `<li>${result.error || 'Word not found'}</li>`;
                }
            } catch (error) {
                console.error('Fetch error:', error);
                resultList.innerHTML = '<li>Error connecting to server</li>';
            } finally {
                loader.style.display = 'none'; // Hide loader
            }
        }

        // Event listeners
        searchButton.addEventListener('click', lookupWord);
        searchBox.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') lookupWord();
        });

        // Load language on page load
        window.onload = loadLanguage;
    </script>
</body>
</html>